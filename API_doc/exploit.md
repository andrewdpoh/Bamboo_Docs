# ALDEN API - Exploit

<!-- Endpoint 1 -->
<br>

## Stop Exploit

Stop exploit process. For logging purposes

### Endpoint

```
POST /exploit/quit
```

### Description

When a Bamboo Client user wants to stop the process of exploiting a Bamboo Agent, Bamboo Client will call this endpoint to notify Bamboo Teamserver about it, for logging purposes.


### Request schema

#### Request body

|Field|Type|Description|
|-----|----|-----------|
|username|String|Username of user|
|agent_identifier|String|Identifier of Bamboo Agent|

### Request example

```
{
    "username": "bambooUser",
    "agent_identifier": "5zrire9a"
}
```

### Response schema

|Status Code|Schema|Description|
|-----------|------|-----------|
|`200`|{"status": "stopped"}|Successfully notified|
|`404`|{"status": "failed"}|Invalid Body|

### Response example

```
{
    "status": "stopped"
}
```


<!-- Endpoint 2 -->
<br>

## Exploit Agent

Handles configuration sent from Bamboo Client to produce a valid payload to Bamboo Agent

### Endpoint

```
POST /exploit/send_config
```

### Description

Exploit Agent is called after a Bamboo Client user finish configuring the exploit to use on the Bamboo Agent. Bamboo Teamserver will first convert the selected evasion method into a standardised one. Next, it will perform a sequence of logic which can be seen in the flowchart below. If Donut is required, Bamboo Teamserver will run the Donut function with the given Donut configuration input by the user. The Donut function will turn the exploit into shellcode before converting the shellcode into hexadecimals. Finally, Bamboo Teamserver will broadcast a WebSocket message to the Bamboo Agent using its agent identifier to give it its command.

![Exploit Flowchart](./img/run_exploit_server.png)

### Request schema

#### Request body

|Field|Type|Description|
|-----|----|-----------|
|username|String|Username of user|
|agent_identifier|String|Identifier of Bamboo Agent|
|need_donut|Boolean|Determines if Donut is required|
|exploit_to_use|String|Exploit name|
|evasion_method|String|Evasion method choosen|
|app_version|String|Version of is affected by exploit|
|uac_bypass|Boolean|Determines if payload require uac_bypass|
|donut_config_data|List of Integers|Donut configurations (if applicable)|
|file2donut|String|File name to generate shellcode using Donut (if applicable)|

### Request example

```
{
    "username": "bambooUser",
    "agent_identifier": "5zrire9a",
    "need_donut": True,
    "exploit_to_use": "filmora.exe",
    "evasion_method": "Process Injection [Injection]",
    "app_version": "Wondershare Filmora v11",
    "uac_bypass": True,
    "donut_config_data": [3, 2, 1, 2],
    "file2donut": "uac_bypass.exe"
}
```

### Response schema

|Status Code|Schema|Description|
|-----------|------|-----------|
|`200`|{"status": "success"}|Successfully notified|
|`400`|{"status": "Agent is not connected to C2 WS"}|Failed to broadcast to Bamboo Agent|
|`404`|{"status": "failed"}|Invalid Body|
|`500`|{"status": "failed"}|Something went wrong|

### Response example

```
{
    "status": "success"
}
```
### WebSocket schema

#### WebSocket body

|Field|Type|Description|
|-----|----|-----------|
|app_version|String|App version that exploit targets|
|command|String|exploit|
|method|String|Evasion method for uac_bypass/exploit|
|shellcode|String|Hexadecimal of exploit file|
|drop_file|String|File to download from Bamboo Teamserver|
|uac_bypass|String|If uac_bypass is needed, will contain evasion method. Else an empty string|

### WebSocket example

```
{
    "app_version": "Bamboooo",
    "command": "exploit",
    "method": "Gadget Injection",
    "shellcode": <Exploit shellcode in Hexadecimal>,
    "drop_file": "",
    "uac_bypass": ""
}
```

<!-- Endpoint 3 -->
<br>

## View Exploits

View all exploits

### Endpoint

```
POST /exploit/view_all
```

### Description

When Bamboo Client uses the {command `exp`}, Bamboo Teamserver will gather all exploits in the database using the `model view_all` and returns it back to Bamboo Client.


### Request schema

#### Request body

|Field|Type|Description|
|-----|----|-----------|
|username|String|Username of user|

### Request example

```
{
    "username": "bambooUser",
}
```

### Response schema

|Status Code|Schema|Description|
|-----------|------|-----------|
|`200`|{"status": "success", "exploit_data": exploit_data}|Successful and there are exploits|
|`200`|{"status": "failed", "exploit_data": exploit_data}|Successful but no exploits|
|`404`|{"status": "failed"}|Invalid Body|

### Response example

```
{
    "status": "success",
    "exploit_data": <dictionary of exploit data>
}
```


<!-- Endpoint 4 -->
<br>

## Add Exploits

Add new exploit

### Endpoint

```
POST /exploit/add
```

### Description

When Bamboo Client uses the {command `add`}, Bamboo Teamserver will upload the new exploit information into the database using the `model add_exploit`. Additionally, using `request.files`, Bamboo Teamserver will place the exploit file into /exploit folder.


### Request schema

#### Request body

|Field|Type|Description|
|-----|----|-----------|
|username|String|Username of user|
|configurations|List|Contains information of new exploit|
|files|Bytes|Bytes of new exploit file (not sent in request body)|


### Request example

#### Request Body

```
{
    "username": "bambooUser",
    "configurations": ["newExploit.exe", "app_version_Bamboo", "user", "system", False, True, True, ""]
}
```

#### multipart/form-data

```
{
    "file": <file bytes>
}
```

### Response schema

|Status Code|Schema|Description|
|-----------|------|-----------|
|`200`|{"status": "success"}|Successfully added new exploit|
|`404`|{"status": "failed"}|Invalid Body|
|`500`|{"staus": "failed"}|Failed to add into database|
|`500`|{"status": "failed"}|Something went wrong|

### Response example

```
{
    "status": "success"
}
```


<!-- Endpoint 5 -->
<br>

## Delete Exploits

Delete a exploit

### Endpoint

```
POST /exploit/delete
```

### Description

When Bamboo Client uses the {command: `delete`}, Bamboo Teamserver will attempt to remove the exploit specified by the Bamboo Client user using the `model del_exploit`. Bamboo Teamserver will remove the information related to the exploit stored in the database, as well as the file stored in Bamboo Teamserver under the /exploits folder.


### Request schema

#### Request body

|Field|Type|Description|
|-----|----|-----------|
|username|String|Username of user|
|exploit_name|String|Name of exploit to delete|

### Request example

#### Request Body

```
{
    "username": "bambooUser",
    "exploit_name": "filmora.exe"
}
```

### Response schema

|Status Code|Schema|Description|
|-----------|------|-----------|
|`200`|{"status": "success"}|Successfully deleted specified exploit|
|`200`|{"staus": "does not exist"}|No such exploit exist in the database|
|`404`|{"status": "failed"}|Invalid Body|

### Response example

```
{
    "status": "success"
}
```


<!-- Endpoint 6 -->
<br>

## Exploit Existence

Determine if an exploit exist in Bamboo Teamserver

### Endpoint

```
POST /exploit/exist
```

### Description

Exploit Existence is used for when the {command `modify`} is called in the Bamboo Client. This endpoint will help determine if a exploit exist in Bamboo Teamserver and return the exploit information if it exist before allowing the Bamboo Client users to start making changes. It uses the `model find_one` to locate the specified exploit.


### Request schema

#### Request body

|Field|Type|Description|
|-----|----|-----------|
|username|String|Username of user|
|exploit_name|String|Name of exploit to delete|

### Request example

#### Request Body

```
{
    "username": "bambooUser",
    "exploit_name": "filmora.exe"
}
```

### Response schema

|Status Code|Schema|Description|
|-----------|------|-----------|
|`200`|{"status": "success", "data": data}|Found the exploit in the database|
|`200`|{"staus": "does not exist"}|No such exploit exist in the database|
|`404`|{"status": "failed"}|Invalid Body|

### Response example

```
{
    "status": "success",
    "data": data
}
```


<!-- Endpoint 7 -->
<br>

## Modify Exploit (CLI)

Modifies exploit specified

### Endpoint

```
POST /exploit/modify
```

### Description

Modify Exploit is called when CLI Bamboo Client calls the {`modify` command}. The Bamboo Client will sent the set of changes to be made, which can vary in sizes and key depending on what needs to be modified. If the exploit name is to be modified, Bamboo Teamserver will change the exploit file name accordingly. Using the `model modify`, Bamboo Teamserver will be able to make dynamic changes to the information of the exploit stored in the database.


### Request schema

#### Request body

|Field|Type|Description|
|-----|----|-----------|
|username|String|Username of user|
|exploit_name|String|Name of exploit to modify|
|changes|Dictionary|Dictionary of changes to be made (dynamic)|

### Request example

#### Request Body

```
{
    "username": "bambooUser",
    "exploit_name": "filmora.exe"
    "changes": {
        "name": "new_name.exe", 
        "app_version": "new_app_version"
    }
}
```

### Response schema

|Status Code|Schema|Description|
|-----------|------|-----------|
|`200`|{"status": "success"}|Successfully modified specified exploit|
|`404`|{"status": "failed"}|Invalid Body|
|`500`|{"staus": "failed"}|Something went wrong|

### Response example

```
{
    "status": "success"
}
```


<!-- Endpoint 8 -->
<br>

## Modify Exploit (GUI)

Modifies exploit specified

### Endpoint

```
POST /exploit/modify_gui
```

### Description

Modify Exploit is called when GUI Bamboo Client calls the {`modify` command}. As Bamboo Client GUI will push all information to Bamboo Teamserver no matter if they were modified, a new endpoint was created to cater to it. Similar to the previous Endpoint, if the name of the exploit to be modified changes its name, the exploit file name will change as well. Using the `model modify_gui`, Bamboo Teamserver will be able to update the information of the exploit all together.


### Request schema

#### Request body

|Field|Type|Description|
|-----|----|-----------|
|username|String|Username of user|
|modified_exploit_name|String|Name of exploit to modify|
|new_name|String|New exploit name|
|new_app_version|String|New app version|
|new_LPE_start|String|New Privilege Escalation Start|
|new_LPE_end|String|New Privilege Escalation End|
|new_uac_bypass|Boolean|New uac_bypass requirement|
|new_d2d|Boolean|New drop-to-disk requirement|
|new_inj|Boolean|New injection requirement|
|new_dropfile|Boolean|New dropfile requirement|

### Request example

#### Request Body

```
{
    "username": "bambooUser",
    "modified_exploit_name": "filmora.exe"
    "new_name": "Pandaaa.exe",
    "modified_exploit_name": "for pandas",
    "new_LPE_start": "admin",
    "new_LPE_end": "system",
    "new_uac_bypass": True,
    "new_d2d": True,
    "new_inj": True,
    "new_dropfile" "Pandaaa.exe"
}
```

### Response schema

|Status Code|Schema|Description|
|-----------|------|-----------|
|`200`|{"status": "success"}|Successfully modified specified exploit|
|`404`|{"status": "failed"}|Invalid Body|
|`500`|{"staus": "failed"}|Something went wrong|

### Response example

```
{
    "status": "success"
}
```